--ALTER SESSION DISABLE PARALLEL QUERY
-- DESDE ADMIN
--*******CASO 1*******

-- 1.- USUARIOS DE BASE DE DATOS Y TAREAS QUE REALIZAN
DROP USER MDY2131_OWNER;
CREATE USER MDY2131_OWNER
IDENTIFIED BY "123456ABcdef";

DROP USER MDY2131_FACTURAS;
CREATE USER MDY2131_FACTURAS
IDENTIFIED BY "123456ABcdef";


-- 2.- ACCIONES QUE PUEDEN REALIZAR EN LA BASE DE DATOS
GRANT CREATE SESSION,
      CREATE TABLE,
      CREATE SYNONYM
      TO MDY2131_OWNER;


GRANT CREATE SESSION,
      CREATE SEQUENCE
      TO MDY2131_FACTURAS;
      
      
-- 3.- GESTIÓN DE ESPACIO
ALTER USER MDY2131_OWNER
DEFAULT TABLESPACE DATA
TEMPORARY TABLESPACE TEMP
QUOTA UNLIMITED ON DATA;


ALTER USER MDY2131_FACTURAS
DEFAULT TABLESPACE DATA
TEMPORARY TABLESPACE TEMP
QUOTA 50M ON DATA;


-- 4.- ACCESO A LOS DATOS Y OBJETOS
DROP SYNONYM SYN_FACTURA;
CREATE SYNONYM SYN_FACTURA
FOR MDY2131_OWNER.FACTURA;

DROP SYNONYM SYN_DETALLE_FACTURA;
CREATE SYNONYM SYN_DETALLE_FACTURA
FOR MDY2131_OWNER.DETALLE_FACTURA;

DROP SYNONYM SYN_PRODUCTO;
CREATE SYNONYM SYN_PRODUCTO
FOR MDY2131_OWNER.PRODUCTO;

DROP SYNONYM SYN_PRODUCTO_HISTORICO;
CREATE SYNONYM SYN_PRODUCTO_HISTORICO
FOR MDY2131_OWNER.PRODUCTO_HISTORICO;

DROP ROLE ROL_FACTURAS;
CREATE ROLE ROL_FACTURAS;
GRANT SELECT, UPDATE, INSERT, DELETE ON SYN_FACTURA TO ROL_FACTURAS;
GRANT SELECT, UPDATE, INSERT, DELETE ON SYN_DETALLE_FACTURA TO ROL_FACTURAS;
GRANT SELECT, UPDATE, INSERT, DELETE ON SYN_PRODUCTO TO ROL_FACTURAS;
GRANT SELECT, UPDATE, INSERT, DELETE ON SYN_PRODUCTO_HISTORICO TO ROL_FACTURAS;
GRANT ROL_FACTURAS TO MDY2131_FACTURAS;

DROP ROLE ROL_CONSULTA;
CREATE ROLE ROL_CONSULTA;
GRANT CREATE TRIGGER,
      CREATE VIEW,
      CREATE PROCEDURE
      TO ROL_CONSULTA;
GRANT ROL_CONSULTA TO MDY2131_OWNER, MDY2131_FACTURAS;


-- 5.- LÍMITES DE RECURSOS Y GESTIÓN DEL ESTADO DE LAS CUENTAS DE USUARIOS
ALTER USER MDY2131_OWNER PROFILE DEFAULT;
DROP PROFILE PROFILE_MDY2131_OWNER;
CREATE PROFILE PROFILE_MDY2131_OWNER LIMIT
    CONNECT_TIME UNLIMITED
    FAILED_LOGIN_ATTEMPTS 5
    PASSWORD_LIFE_TIME 90;
ALTER USER MDY2131_OWNER PROFILE PROFILE_MDY2131_OWNER;


ALTER USER MDY2131_FACTURAS PROFILE DEFAULT;
DROP PROFILE PROFILE_MDY2131_FACTURAS;
CREATE PROFILE PROFILE_MDY2131_FACTURAS LIMIT
    CONNECT_TIME 30
    FAILED_LOGIN_ATTEMPTS 3
    PASSWORD_LIFE_TIME 30
    PASSWORD_LOCK_TIME 0.5;
ALTER USER MDY2131_FACTURAS PROFILE PROFILE_MDY2131_FACTURAS;
    
    
--*******CASO 2*******



--*******CASO 3*******
--DESDE MDY2131_FACTURAS
DROP VIEW productos_por_codigo_view;
CREATE VIEW productos_por_codigo_view AS
SELECT codproducto AS codigo,
       INITCAP(descripcion) as descripcion,
       vunitario AS valor_unitario,
       totalstock AS stock
FROM syn_producto_historico
WHERE SUBSTR(descripcion, -1) = '&numero'
ORDER BY totalstock DESC;

--*******CASO 4*******
--DESDE 
CREATE INDEX MDY2131_OWNER.PROD_HIST_DESC_IX
ON syn_producto_historico (SUBSTR(descripcion, -1) = '&numero');

DROP INDEX MDY2131_OWNER.PROD_HIST_DESC_IX;



