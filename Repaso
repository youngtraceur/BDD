SELECT F.NUMFACTURA AS NUMFACTURA, F.FECHA AS "FECHA_VENTA",
    COUNT(DISTINCT DF.CODPRODUCTO) AS "PRODUCTOS_DISTINTOS",
    TO_CHAR(SUM(DF.TOTALLINEA), '$999G999G999') AS "TOTAL_VENTA"
FROM FACTURA F
INNER JOIN
    DETALLE_FACTURA DF ON F.NUMFACTURA = DF.NUMFACTURA
GROUP BY
    F.NUMFACTURA, F.FECHA
HAVING
    COUNT(DISTINCT DF.CODPRODUCTO) >= 2
ORDER BY PRODUCTOS_DISTINTOS DESC;



--primera parte caso 2 prueba factura
SELECT
    V.RUTVENDEDOR AS RUT,
    V.NOMBRE AS Nombre,
    'Vendedor(a)' AS Tipo,
    0 AS TotalComprado,
    SUM(F.TOTAL) AS TotalVendido
FROM VENDEDOR V
LEFT JOIN FACTURA F ON V.RUTVENDEDOR = F.RUTVENDEDOR
LEFT JOIN BOLETA B ON V.RUTVENDEDOR = B.RUTVENDEDOR
GROUP BY V.RUTVENDEDOR, V.NOMBRE

UNION ALL

SELECT
    C.RUTCLIENTE AS RUT,
    C.NOMBRE AS Nombre,
    'Cliente' AS Tipo,
    SUM(F.TOTAL) AS TotalComprado,
    0 AS TotalVendido
FROM CLIENTE C
LEFT JOIN FACTURA F ON C.RUTCLIENTE = F.RUTCLIENTE
LEFT JOIN BOLETA B ON C.RUTCLIENTE = B.RUTCLIENTE
GROUP BY C.RUTCLIENTE, C.NOMBRE;
