SELECT UNI.NOMBRE as UNIDAD,
    MED.PNOMBRE||' '||MED.SNOMBRE||' '||MED.APATERNO||' '||MED.AMATERNO AS MEDICO,
    MED.TELEFONO AS TELEFONO,
    SUBSTR(UNI.NOMBRE,1 ,2)||''||SUBSTR(APATERNO,-3,2)||''||SUBSTR(TELEFONO,-3,3)||''||TO_CHAR(FECHA_ATENCION,'DDMM')||'@medicocktk.cl.' AS CORREO_MEDICO
   
FROM MEDICO MED
INNER JOIN UNIDAD UNI
ON MED.UNI_ID = UNI.UNI_ID
INNER JOIN ATENCION ATE
ON MED.MED_RUN = ATE.MED_RUN
INNER JOIN PAGO_ATENCION PAG
ON ATE.ATE_ID = PAG.ATE_ID
ORDER BY apaterno


SELECT ATE.MED_RUN, COUNT(ATE.ATE_ID)
FROM ATENCION ATE 
WHERE EXTRACT(YEAR FROM ATE.FECHA_ATENCION)
EXTRACT(YEAR FROM CURRENT_DATE)-1 
